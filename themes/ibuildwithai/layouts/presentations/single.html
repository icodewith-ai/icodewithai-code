{{ define "main" }}
    <main>
        <article class="blog-single">
            <div class="container">
                <span class="content-type-header">Presentation</span>
                <h1>{{ .Title }}</h1>
                <div class="post-meta">
                    {{ dateFormat "January 2, 2006" .Params.date_time }} at {{ dateFormat "3:04 PM" .Params.date_time }} {{ .Params.timezone }}
                    <br>
                    {{ if .Params.presenter }}
                    {{ $presenterKeys := split .Params.presenter "," }}
                    {{ $presenterNames := slice }}
                    {{ range $presenterKeys }}
                        {{ $key := trim . " " }}
                        {{ $presenterData := index $.Site.Data.people $key }}
                        {{ if $presenterData }}
                            {{ $presenterNames = $presenterNames | append $presenterData.fullName }}
                        {{ end }}
                    {{ end }}
                    {{ if $presenterNames }}
                        Presented by 
                        {{ if eq (len $presenterNames) 1 }}
                            {{ index $presenterNames 0 }}
                        {{ else if eq (len $presenterNames) 2 }}
                            {{ index $presenterNames 0 }} and {{ index $presenterNames 1 }}
                        {{ else }}
                            {{ $lastIndex := sub (len $presenterNames) 1 }}
                            {{ range $i, $name := $presenterNames }}
                                {{ if eq $i $lastIndex }}, and {{ $name }}{{ else if eq $i 0 }}{{ $name }}{{ else }}, {{ $name }}{{ end }}
                            {{ end }}
                        {{ end }}
                    {{ end }}
                    {{ end }}{{ if .Params.location }} at {{ .Params.location }}{{ end }}
                    <br>
                    {{ if .Params.meeting_type }}This {{ if eq .Params.status "completed" }}was{{ else }}is{{ end }} an {{ .Params.meeting_type }} presentation.{{ end }}
                </div>
                
                {{ if eq .Params.status "on-demand" }}
                    <!-- YouTube Video Embed for On-Demand Presentations -->
                    {{ if and .Params.on_demand_url (ne .Params.on_demand_url "") }}
                        {{ $videoID := "" }}
                        {{ if (findRE "youtu\\.be/" .Params.on_demand_url) }}
                            {{ $videoID = index (last 1 (split .Params.on_demand_url "/")) 0 }}
                        {{ else if (findRE "watch\\?v=" .Params.on_demand_url) }}
                            {{ $videoID = index (split (index (last 1 (split .Params.on_demand_url "v=")) 0) "&") 0 }}
                        {{ else if (findRE "embed/" .Params.on_demand_url) }}
                            {{ $videoID = index (last 1 (split .Params.on_demand_url "/")) 0 }}
                        {{ end }}
                        {{ if $videoID }}
                        <div class="blog-single-image">
                            <div class="video-embed-responsive">
                                <iframe
                                    src="https://www.youtube.com/embed/{{ $videoID }}"
                                    frameborder="0"
                                    allowfullscreen>
                                </iframe>
                            </div>
                        </div>
                        {{ end }}
                    {{ end }}
                {{ else }}
                    {{ if and .Params.image .Params.displayImageInline }}
                        {{ $imagePath := strings.TrimPrefix "/" .Params.image }}
                        {{ $presentationImg := resources.Get $imagePath }}
                        {{ if $presentationImg }}
                            {{ $presentationImgFingerprint := $presentationImg | resources.Fingerprint }}
                            <div class="blog-single-image">
                                <img src="{{ $presentationImgFingerprint.RelPermalink }}" alt="{{ .Title }}" loading="lazy">
                            </div>
                        {{ end }}
                    {{ end }}
                {{ end }}
                
                <div class="content">
                    <h3 class="project-links-title">About the Presentation</h3>
                    {{ .Content }}
                </div>
                
                <div class="content">
                    <h3 class="project-links-title">Audience</h3>
                    {{ .Params.audience }}
                </div>
                
                <!-- About the Presenter(s) Section -->
                {{ if .Params.presenter }}
                {{ $presenterKeys := split .Params.presenter "," }}
                {{ $presentersData := slice }}
                {{ range $presenterKeys }}
                    {{ $key := trim . " " }}
                    {{ $presenterData := index $.Site.Data.people $key }}
                    {{ if $presenterData }}
                        {{ $presentersData = $presentersData | append $presenterData }}
                    {{ end }}
                {{ end }}
                {{ if $presentersData }}
                <div class="content">
                    <h3 class="project-links-title">About the {{ if eq (len $presentersData) 1 }}Presenter{{ else }}Presenters{{ end }}</h3>
                </div>
                {{ range $presentersData }}
                <div class="guest-photo-section">
                    <div class="guest-content">
                        <div class="guest-photo">
                            {{ $presenterImgPath := strings.TrimPrefix "/" .image }}
                            {{ $presenterImg := resources.Get $presenterImgPath }}
                            {{ if $presenterImg }}
                                {{ $presenterImgFingerprint := $presenterImg | resources.Fingerprint }}
                                <img src="{{ $presenterImgFingerprint.RelPermalink }}" alt="{{ .fullName }}" loading="lazy">
                            {{ else }}
                                <p>Debug: Image not found at {{ .image }}</p>
                            {{ end }}
                        </div>
                        <div class="guest-info">
                            <h3>{{ .fullName }}, {{ .title }} @ {{ .company }}</h3>
                            <p>{{ .bio }}</p>
                            {{ if and .learnMoreLink (ne .learnMoreLink "") }}
                            <div class="guest-link-wrapper">
                                <a href="{{ .learnMoreLink }}" class="section-link" target="_blank" rel="noopener noreferrer">Learn More →</a>
                            </div>
                            {{ end }}
                        </div>
                    </div>
                </div>
                {{ end }}
                {{ end }}
                {{ end }}

                {{ if ne .Params.status "on-demand" }}
                    {{ if or .Params.learn_more_url .Params.on_demand_url .Params.register_url }}
                    <div class="project-links-section">
                        <h3 class="project-links-title">Links</h3>
                        <div class="project-links">
                            {{ if .Params.register_url }}
                            <a href="{{ .Params.register_url }}" target="_blank" class="btn-primary">
                                Register to Attend
                            </a>
                            {{ end }}
                            {{ if .Params.learn_more_url }}
                            <a href="{{ .Params.learn_more_url }}" target="_blank" class="btn-secondary">
                                Learn More
                            </a>
                            {{ end }}
                            {{ if .Params.on_demand_url }}
                            <a href="{{ .Params.on_demand_url }}" target="_blank" class="btn-secondary">
                                Watch On-Demand
                            </a>
                            {{ end }}
                        </div>
                    </div>
                    {{ end }}
                {{ end }}
                
                <div class="back-link-section">
                    <a href="{{ "presentations/" | relURL }}" class="back-link">← Back to Presentations</a>
                </div>
            </div>
        </article>
    </main>
{{ end }}