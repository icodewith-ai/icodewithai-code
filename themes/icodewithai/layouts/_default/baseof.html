<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Plausible Analytics (production only) -->
    {{ if eq hugo.Environment "prod" }}
    <script defer data-domain="icodewith.ai" src="https://plausible.io/js/script.file-downloads.hash.outbound-links.pageview-props.tagged-events.js"></script>
    <script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script>
    {{ end }}
    
    <!-- SEO Meta Tags -->
    {{ partial "seo.html" . }}
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ "images/favicon.ico" | absURL }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ "images/apple-touch-icon.png" | absURL }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ "images/favicon-32x32.png" | absURL }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ "images/favicon-16x16.png" | absURL }}">
    
    <!-- Android Chrome -->
    <link rel="icon" type="image/png" sizes="192x192" href="{{ "images/android-chrome-192x192.png" | absURL }}">
    <link rel="icon" type="image/png" sizes="512x512" href="{{ "images/android-chrome-512x512.png" | absURL }}">
    
    <!-- Resource Preconnect Hints -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Preload critical resources -->
    {{ $logo := resources.Get "images/logo.png" | resources.Fingerprint }}
    {{ if $logo }}
    <link rel="preload" href="{{ $logo.RelPermalink }}" as="image">
    {{ end }}
    
    <!-- Critical CSS (Inlined) -->
    <style>
        /* Critical Above-the-fold CSS */
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--color-primary:#10b981;--color-bg:#0a0a0a;--color-text:#f3f4f6;--color-text-secondary:#9ca3af;--transition-base:0.3s ease}
        html{scroll-behavior:smooth}
        body{font-family:"DM Sans",system-ui,-apple-system,sans-serif;background-color:#0a0a0a;color:#f3f4f6;line-height:1.6;font-display:swap}
        .container{max-width:1200px;margin:0 auto;padding:0 2rem}
        .header{position:sticky;top:0;z-index:1000;background:rgba(10,10,10,0.95);backdrop-filter:blur(10px);border-bottom:1px solid #374151;padding:1rem 0}
        .logo-section{display:flex;align-items:center;gap:0.75rem}
        .logo-image{height:2.5rem;width:auto}
        .hero{text-align:center;padding:4rem 0 3rem 0}
        .hero h1{font-size:3rem;font-weight:700;margin-bottom:1rem;background:linear-gradient(135deg,#10b981,#059669);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .highlight{color:#10b981}
        .tagline{font-size:1.25rem;color:#9ca3af;margin-bottom:2rem}
        @media (max-width:768px){
            .container{padding:0 1rem}
            .hero h1{font-size:2rem}
            .tagline{font-size:1.1rem}
        }
    </style>
    
    <!-- Google Fonts (Optimized with font-display:swap and reduced font weights) -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&display=swap"></noscript>
    
    <!-- Main Stylesheet (Deferred) -->
    {{ $style := resources.Get "scss/styles.scss" | css.Sass | resources.Minify }}
    <link rel="preload" href="{{ $style.Permalink }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ $style.Permalink }}"></noscript>
    
    <!-- Fallback script for async CSS loading -->
    <script>
        !function(e){"use strict";var t=function(t,n,r){function o(e){return i.body?e():void setTimeout(function(){o(e)})}function d(){a.addEventListener&&a.removeEventListener("load",d),a.media=r||"all"}var i=e.document,a=i.createElement("link");if(n)a.id=n;a.rel="stylesheet",a.href=t,a.media="only x",o(function(){i.head.appendChild(a)}),setTimeout(d),a.addEventListener&&a.addEventListener("load",d)};"undefined"!=typeof exports?exports.loadCSS=t:e.loadCSS=t}("undefined"!=typeof global?global:this);
    </script>
</head>
<body>
    <!-- Staging Password Protection -->
    {{ if .Site.Params.staging_password }}
    <div id="password-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #0a0a0a; z-index: 9999; justify-content: center; align-items: center;">
        <div style="text-align: center; max-width: 400px; padding: 2rem;">
            <h2 style="color: #10b981; font-size: 1.5rem; margin-bottom: 1.5rem; font-weight: 600;">'Next' Access</h2>
            <input type="password" id="staging-password" placeholder="Enter password" style="width: 100%; padding: 0.75rem; margin-bottom: 1rem; border: 1px solid #374151; border-radius: 0.375rem; background-color: #1f2937; color: #f3f4f6; font-size: 1rem;">
            <button id="password-submit" style="width: 100%; padding: 0.75rem; background-color: #10b981; color: #ffffff; border: none; border-radius: 0.375rem; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background-color 0.3s ease;">
                Login
            </button>
            <div id="password-error" style="color: #ef4444; margin-top: 0.5rem; font-size: 0.875rem; display: none;">
                Incorrect password. Please try again.
            </div>
        </div>
    </div>
    {{ end }}
    <div class="header">
        {{ partial "header.html" . }}
    </div>

    {{ block "main" . }}{{ end }}

    {{ partial "footer.html" . }}
    
    <!-- Staging Password Protection Script -->
    {{ if .Site.Params.staging_password }}
    <script>
        (function() {
            const PASSWORD = '{{ .Site.Params.staging_password }}';
            const STORAGE_KEY = 'staging_access_granted';
            
            function checkPassword() {
                // Check if user already entered password this session
                if (sessionStorage.getItem(STORAGE_KEY) === 'true') {
                    return;
                }
                
                // Show password overlay
                const overlay = document.getElementById('password-overlay');
                overlay.style.display = 'flex';
                
                // Focus on password input
                const passwordInput = document.getElementById('staging-password');
                passwordInput.focus();
                
                // Handle password submission
                function submitPassword() {
                    const enteredPassword = passwordInput.value;
                    const errorDiv = document.getElementById('password-error');
                    
                    if (enteredPassword === PASSWORD) {
                        sessionStorage.setItem(STORAGE_KEY, 'true');
                        overlay.style.display = 'none';
                        errorDiv.style.display = 'none';
                    } else {
                        errorDiv.style.display = 'block';
                        passwordInput.value = '';
                        passwordInput.focus();
                    }
                }
                
                // Button click handler
                document.getElementById('password-submit').addEventListener('click', submitPassword);
                
                // Enter key handler
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        submitPassword();
                    }
                });
                
                // Hover effect for button
                const button = document.getElementById('password-submit');
                button.addEventListener('mouseenter', function() {
                    button.style.backgroundColor = '#059669';
                });
                button.addEventListener('mouseleave', function() {
                    button.style.backgroundColor = '#10b981';
                });
            }
            
            // Run password check when page loads
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', checkPassword);
            } else {
                checkPassword();
            }
        })();
    </script>
    {{ end }}
    
    <!-- Mobile Menu Script (Deferred) -->
    {{ $mobileMenuJS := resources.Get "js/mobile-menu.js" | resources.Minify | resources.Fingerprint }}
    {{ if $mobileMenuJS }}
    <script defer src="{{ $mobileMenuJS.RelPermalink }}"></script>
    {{ end }}
    
    <!-- Navigation Dropdown Script (Deferred) -->
    {{ $navDropdownJS := resources.Get "js/nav-dropdown.js" | resources.Minify | resources.Fingerprint }}
    {{ if $navDropdownJS }}
    <script defer src="{{ $navDropdownJS.RelPermalink }}"></script>
    {{ end }}
</body>
</html>